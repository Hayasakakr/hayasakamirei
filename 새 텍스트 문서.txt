{"meta":"","name":"사용자 스크립트","description":"사용자가 직접 등록한 스크립트는 이곳에 표시됩니다.","theme":{"background":"#333","color":"#fff"},"version":"","contents":[{"action":"key","name":"2코입갤","script":"javascript: (\n    function () {\n        /*\n        leader = 메인 리더 카드 지정 (이름을 비워두면 메인 리더를 유지함)\n        dorm = 처넣을 기숙사 순번 (0으로 설정하면 기숙사 입실을 하지 않음)\n        channel = 접속할 도장: 1 = saasan, 2 = mobamasdojo, 3 = 로컬 저장소 (0으로 설정하면 도장에 접속하지 않음)\n        */\n        var leader = \"中野有香+\";\n        var dorm = 3;\n        var channel = 1;\n        var dojo = [,\n            \"https://imcg.pink-check.school/dojo\",\n            \"https://mobamasdojo.firebaseapp.com\",\n            \"localStorage\"\n        ]\n        var main = 'http://sp.pf.mbga.jp/12008305/?guid=ON&url=http://125.6.169.35/idolmaster/';\n        var form = new FormData();\n        var xhr = new XMLHttpRequest();\n        function now(p, s) { document.title = '[' + p + '/4] ' + s }\n        function search() {\n            var result = {};\n            page = max = 1;\n            do {\n                now(1, \"카드 정보 수집 (\" + page + \"/\" + max + \")...\");\n                $.ajax({\n                    type: 'GET',\n                    url: main + \"card_list/index/0/?history=1%26target_page_num=\" + page++,\n                    async: false,\n                    success: function (data) {\n                        max = $(data).find(\".pager_panel_area\").text().split(\"/\")[1] * 1;\n                        var response = $(data).find(\".area_card_status\").get();\n                        for (card of response) {\n                            var id = decodeURIComponent(card.querySelector(\"a.area_card_name\").href).split(/[/?]/)[11];\n                            var name = card.querySelector(\".card_name\").innerText;\n                            result[id] = { 'name': name };\n                        }\n                    }\n                });\n            }\n            while ((page <= max) && (page <= 10));\n            return result\n        }\n        function setLeader() {\n            now(2, '리더 카드 변경 중...');\n            for (id in list) {\n                if (list[id].name == leader) {\n                    form.append('sleeve', id);\n                    xhr.open('POST', main + 'deck/deck_set_leader_card', false);\n                    xhr.send(form);\n                    delete list[id];\n                    return 1\n                }\n            }\n        }\n        var list = search();\n        if (leader ? setLeader() : 1) {\n            if (dorm) {\n                var form = new FormData();\n                now(3, \"넣는다!...\");\n                for (id in list) {\n                    form.append('sleeve[]', id);\n                }\n                form.append('is_push', 1);\n                $.ajax({\n                    type: 'GET',\n                    url: main + 'card_storage/push_index/0/0/0/1/' + dorm,\n                    async: false,\n                    success: function (data) {\n                        if ($(data).find(\"header > div > div\").text().split(/[/人]/)[1] * 1 < list.length) {\n                            alert(dorm + \"번 기숙사의 여유공간이 부족하거나, 기숙사에 접속할 수 없습니다.\");\n                            return\n                        }\n                        xhr.open('POST', main + 'card_storage/push_index/0/0/0/1/' + dorm, false);\n                        xhr.send(form);\n                    }\n                });\n            }\n        } else {\n            alert('리더 카드 변경에 실패했습니다.\\n' + leader + ' 카드를 리스트에서 찾을 수 없습니다.');\n            return\n        }\n        if (dojo[channel]) {\n            now(4, \"입갤...\");\n            if (dojo[channel] == \"localStorage\") {\n                var DJ = JSON.parse(localStorage.getItem('vove.dojo') || '[]')\n                var last = localStorage.getItem('vove.dojo.last') || ''\n                var date = new Date()\n                var now = [date.getFullYear(), date.getMonth() + 1, date.getDate(), date.getHours()];\n                for (i in now) {\n                    if (now[i] < 10) {\n                        now[i] = \"0\" + now[i];\n                    }\n                    now[i] += ''\n                }\n                var now = now[0] + now[1] + now[2] + now[3]\n                if (last) {\n                    var nowdate = now.slice(0, 8) * 1\n                    var nowhours = now.slice(8) * 1\n                    var lastdate = last.slice(0, 8) * 1\n                    var lasthours = last.slice(8) * 1\n                    if ((nowdate > lastdate && nowhours >= 5) || (nowdate == lastdate && nowhours >= 5 && lasthours < 5)) {\n                        for (var i = 0; i < DJ.length; i++) {\n                            for (var j = i + 1; j < DJ.length; j++) {\n                                if (DJ[i].id === DJ[j].id) {\n                                    if (DJ[i].failed > DJ[j].failed) {\n                                        DJ.splice(j, 1)\n                                    } else {\n                                        DJ.splice(i, 1)\n                                    }\n                                }\n                            }\n                        }\n                        for (i = 0; i < DJ.length; i++) {\n                            DJ[i].enable = 1\n                        }\n                        DJ.sort(function (a, b) {\n                            return b.enable - a.enable || a.failed - b.failed || b.lv - a.lv\n                        });\n                        localStorage.setItem('vove.dojo', JSON.stringify(DJ))\n                    }\n                }\n                localStorage.setItem('vove.dojo.last', now)\n                DJ.sort(function (a, b) {\n                    return b.enable - a.enable || b.lv - a.lv;\n                });\n                localStorage.setItem('vove.dojo', JSON.stringify(DJ))\n                if (DJ[0]) {\n                    location = 'http://sp.pf.mbga.jp/12008305/?guid=ON&url=http://125.6.169.35/idolmaster/battles/battle_check/' + DJ[0].id\n                    return\n                }\n                alert(DJ[0] ? '모든 로컬 도장을 사용했습니다.' : '로컬에 저장된 도장이 없습니다.')\n            }\n            location = dojo[channel];\n        }\n    }\n)();","url":["http://sp.pf.mbga.jp/12008305/*"],"key":">+1","activate":true}]}